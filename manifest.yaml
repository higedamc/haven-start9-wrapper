# ==============================================================================
# Haven Start9 Package Manifest
# ==============================================================================

id: haven
title: Haven
version: 1.0.8
ui: false
release-notes: |
  **v1.0.8 - Critical Tor Address Persistence Fix (2025-12-25)**
  
  CRITICAL Bug Fixes:
  - **BREAKING FIX**: Tor Hidden Service directory now persists to /data/tor/haven/ (prevents .onion address from changing on updates)
  - This fix ensures your .onion address remains the same across package updates and restarts
  - Note: If you already updated to 1.0.7, your .onion address will change one more time with this update, but will then remain stable
  
  **v1.0.7 - Blossom Server Hotfix (2025-12-25)**
  
  Bug Fixes:
  - Fixed Blossom file storage path issue (media files now correctly saved to /data/blossom/)
  - Changed all relay ServiceURLs from https:// to http:// for proper Tor .onion address compatibility
  - Added detailed error logging for Blossom file operations (create, read, delete)
  - Fixed BlossomPath configuration to prevent trailing slash issues
  
  Improvements:
  - Enhanced Blossom server initialization logging for easier debugging
  - Improved error messages for media upload/download operations
  
  **v1.0.6 - Initial Release**
  - Initial Start9 release
  - Tor-only operation for maximum privacy
  - Full Blossom server support (NIP-96 & BUD-02 compliant)
  - Web of Trust integration for spam protection
  - Four specialized Nostr relays (Private, Chat, Inbox, Outbox)
  - BadgerDB and LMDB database engine support
license: MIT
wrapper-repo: https://github.com/bitvora/haven-start9-wrapper
upstream-repo: https://github.com/bitvora/haven
support-site: https://github.com/bitvora/haven/issues
marketing-site: https://github.com/bitvora/haven
donation-url: null

# ==============================================================================
# Package Description
# ==============================================================================

description:
  short: Self-sovereign Nostr relay suite with Blossom media server
  long: |
    Haven (High Availability Vault for Events on Nostr) is a comprehensive 
    personal Nostr relay implementation featuring four specialized relays 
    and an integrated Blossom media server. Run your own sovereign 
    communications infrastructure over Tor.
    
    **Features:**
    - **Private Relay**: Your personal secure storage for drafts and private notes
    - **Chat Relay**: Web of Trust protected direct messages (NIP-04)
    - **Inbox Relay**: Receive tagged events from trusted sources
    - **Outbox Relay**: Public broadcast of your events
    - **Blossom Server**: Decentralized media hosting (NIP-96 & BUD-02 compliant)
    - **Web of Trust**: Automatic spam protection based on your social graph
    - **Tor-Only**: Maximum privacy with .onion addresses
    - **Multiple DB Engines**: Choose between BadgerDB or LMDB
    - **Cloud Backups**: Optional S3-compatible backup integration
    
    **Compatible Clients:**
    - Amethyst (Android) - Full support including Blossom
    - Damus (iOS)
    - Primal
    - Coracle
    - nostrudel
    - And any Nostr client supporting NIP-42 (Auth)

# ==============================================================================
# Package Assets
# ==============================================================================

assets:
  license: LICENSE
  icon: icon.png
  instructions: instructions.md
  docker-images: docker-images.tar

# ==============================================================================
# Main Container Configuration
# ==============================================================================

main:
  type: docker
  image: main
  entrypoint: docker_entrypoint.sh
  args: []
  mounts:
    main: /data
  gpu-acceleration: false
  shm-size-mb: null

# ==============================================================================
# Health Checks
# ==============================================================================

health-checks:
  main:
    name: Web Interface
    success-message: Haven is running and accessible
    type: docker
    image: main
    entrypoint: check-web.sh
    args: []
    io-format: json
    inject: false
    mounts:
      main: /data

# ==============================================================================
# Configuration Management
# ==============================================================================

config:
  get:
    type: script
  set:
    type: script

# ==============================================================================
# Properties Display
# ==============================================================================

properties:
  type: docker
  image: main
  entrypoint: properties.sh
  args: []
  mounts:
    main: /data
  io-format: yaml
  inject: false

# ==============================================================================
# Volume Configuration
# ==============================================================================

volumes:
  main:
    type: data

# ==============================================================================
# Network Interfaces
# ==============================================================================

interfaces:
  main:
    name: Nostr Relay Interface
    description: Main Nostr relay endpoint (WebSocket) and Blossom media server
    tor-config:
      port-mapping:
        "3355": "80"
    lan-config: null
    ui: true
    protocols:
      - tcp
      - http
      - ws

# ==============================================================================
# Dependencies
# ==============================================================================

dependencies: {}

# ==============================================================================
# Backup Configuration
# ==============================================================================

backup:
  create:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - duplicity
      - create
      - /mnt/backup
      - /data
    mounts:
      BACKUP: /mnt/backup
      main: /data
  restore:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - duplicity
      - restore
      - /mnt/backup
      - /data
    mounts:
      BACKUP: /mnt/backup
      main: /data

# ==============================================================================
# Migrations
# ==============================================================================

migrations:
  from: {}
  to: {}

